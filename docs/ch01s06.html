<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>Constructing Trajectories</title><link rel="stylesheet" type="text/css" href="docbook.css"><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot"><link rel="home" href="index.html" title="MobilityDB Workshop"><link rel="up" href="ch01.html" title="Chapter 1. Managing Ship Trajectories (AIS)"><link rel="prev" href="ch01s05.html" title="Loading the Data"><link rel="next" href="ch01s07.html" title="Basic Data Exploration"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Constructing Trajectories</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch01s05.html">Prev</a> </td><th width="60%" align="center">Chapter 1. Managing Ship Trajectories (AIS)</th><td width="20%" align="right"> <a accesskey="n" href="ch01s07.html">Next</a></td></tr></table><hr></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm198"></a>Constructing Trajectories</h2></div></div></div><p>
				Now we are ready to construct ship trajectories out of their individual observations:
			</p><p>
				</p><pre class="programlisting">
CREATE TABLE Ships(MMSI, Trip, SOG, COG) AS 
SELECT MMSI, 
  tgeompoint_seq(array_agg(tgeompoint_inst(ST_Transform(Geom, 25832), T) ORDER BY T)), 
  tfloat_seq(array_agg(tfloat_inst(SOG, T) ORDER BY T) FILTER (WHERE SOG IS NOT NULL)), 
  tfloat_seq(array_agg(tfloat_inst(COG, T) ORDER BY T) FILTER (WHERE COG IS NOT NULL)) 
FROM AISInputFiltered 
GROUP BY MMSI;
-- Query returned successfully: 6264 rows affected, 00:52 minutes execution time.
</pre><p>
			</p><p>
				This query constructs, per ship, its spatiotemporal trajectory <code class="varname">Trip</code>, and two temporal attributes <code class="varname">SOG</code> and <code class="varname">COG</code>. <code class="varname">Trip</code> is a temporal geometry point, and both <code class="varname">SOG</code> and <code class="varname">COG</code> are temporal floats. MobilityDB builds on the coordinate transformation feature of PostGIS. Here the SRID 25832 (European Terrestrial Reference System 1989) is used, because it is the one advised by Danish Maritime Authority in the download page of this dataset. <a class="xref" href="ch01s06.html#imgtrajs" title="Figure 1.2. Visualizing the ship trajectories">Figure 1.2, &#8220;Visualizing the ship trajectories&#8221;</a> shows the constructed trajectories in QGIS. 
			</p><p>
				</p><pre class="programlisting">
ALTER TABLE Ships ADD COLUMN Traj geometry;
UPDATE Ships SET Traj = trajectory(Trip);
-- Query returned successfully: 6264 rows affected, 3.8 secs execution time.
</pre><p>
			</p><p>
				<a class="xref" href="ch01s06.html#imgtrajs" title="Figure 1.2. Visualizing the ship trajectories">Figure 1.2, &#8220;Visualizing the ship trajectories&#8221;</a> shows the constructed trajectories in QGIS. Notice that there are still significant errors in the data, in particular the vertical lines. These errors need to be corrected so that the analytical queries in the following sections return more accurate results. We do not cope with this issue here, since the topic of trajectory cleaning is beyond the scope of this introductory workshop.
			</p><p>
				</p><div class="figure-float"><div class="figure"><a name="imgtrajs"></a><p class="title"><b>Figure 1.2. Visualizing the ship trajectories</b></p><div class="figure-contents"><div class="mediaobject"><img src="images/trajs.png" alt="Visualizing the ship trajectories"></div></div></div><br class="figure-break"></div><p>
			</p></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch01s05.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="ch01.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="ch01s07.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Loading the Data </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> Basic Data Exploration</td></tr></table></div></body></html>
